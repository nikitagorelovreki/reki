<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>Reki — Форма осмотра (MVP UI)</title>
  <link rel="stylesheet" href="css/styles.css">
  <!-- Chart.js для радарной диаграммы -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>Reki — Тесты оценки пациента (MVP)</h1>
      <div class="toolbar">
        <span class="pill"><span class="muted">Пациент</span>
          <select id="patientSelect">
            <option value="">Выберите пациента...</option>
          </select>
        </span>
        <span class="pill"><span class="muted">Тип теста</span>
          <select id="testTypeSelect">
            <option value="lfk">Осмотр ЛФК</option>
            <option value="fim">FIM — мера функциональной независимости</option>
            <option value="patients">Управление пациентами</option>
          </select>
        </span>
        <button class="primary" id="saveJsonBtn">Сохранить JSON</button>
        <button id="loadJsonBtn">Загрузить JSON</button>
        <input type="file" id="jsonFile" accept="application/json" hidden />
        <button class="ghost" id="printBtn">Печать / PDF</button>
        <button class="ghost" id="resetBtn">Сбросить</button>
      </div>
    </header>

    <!-- ====== ТЕСТ 1: Осмотр ЛФК ====== -->
    <div id="test-lfk" data-test="lfk">
      <div class="tabs" role="tablist">
        <div class="tab active" data-tab="exam" onclick="switchTab('exam')">1) Осмотр и двигательные навыки</div>
        <div class="tab" data-tab="gait" onclick="switchTab('gait')">2) Походка / установка конечностей</div>
        <div class="tab" data-tab="plan" onclick="switchTab('plan')">3) План терапии / задачи</div>
      </div>

      <div id="panel-exam" class="panel" role="tabpanel">
        <div class="section">
          <div class="kicker">Раздел</div>
          <h3>Двигательные навыки</h3>
          <div class="grid">
            <div class="col-6">
              <div class="group" data-field="head_hold">
                <div class="label-row"><div class="label">Удержание головы</div></div>
                <div class="chips" data-type="checkbox-group">
                  <label class="chip"><input type="checkbox" value="Удерживает"/>Удерживает</label>
                  <label class="chip"><input type="checkbox" value="Не удерживает"/>Не удерживает</label>
                  <label class="chip"><input type="checkbox" value="Удерживает несколько минут"/>Удерживает несколько минут</label>
                  <label class="chip"><input type="checkbox" value="С наклоном вправо"/>С наклоном вправо</label>
                  <label class="chip"><input type="checkbox" value="С наклоном влево"/>С наклоном влево</label>
                </div>
              </div>

              <div class="group" data-field="rollover">
                <div class="label-row"><div class="label">Перевороты</div></div>
                <div class="chips" data-type="checkbox-group">
                  <label class="chip"><input type="checkbox" value="Со спины на живот"/>Со спины на живот</label>
                  <label class="chip"><input type="checkbox" value="С живота на спину"/>С живота на спину</label>
                  <label class="chip"><input type="checkbox" value="Блоком"/>Блоком</label>
                  <label class="chip"><input type="checkbox" value="Вправо"/>Вправо</label>
                  <label class="chip"><input type="checkbox" value="Влево"/>Влево</label>
                </div>
              </div>

              <div class="group" data-field="prone">
                <div class="label-row"><div class="label">Лёжа на животе</div></div>
                <div class="chips" data-type="checkbox-group">
                  <label class="chip"><input type="checkbox" value="Опоры на руки нет"/>Опоры на руки нет</label>
                  <label class="chip"><input type="checkbox" value="Опирается на предплечья"/>Опирается на предплечья</label>
                  <label class="chip"><input type="checkbox" value="Опирается на выпрямленные руки"/>Опирается на выпрямленные руки</label>
                  <label class="chip"><input type="checkbox" value="Кисти сжаты в кулак"/>Кисти сжаты в кулак</label>
                  <label class="chip"><input type="checkbox" value="D"/>D</label>
                  <label class="chip"><input type="checkbox" value="S"/>S</label>
                </div>
              </div>

              <div class="group" data-field="sitting_on_heels">
                <div class="label-row"><div class="label">Переход в позу сидя на пятках</div><span class="hint">(точные варианты из скриншота можно дополнить)</span></div>
                <div class="chips" data-type="checkbox-group">
                  <label class="chip"><input type="checkbox" value="Отсутствует"/>Отсутствует</label>
                  <label class="chip"><input type="checkbox" value="У опоры"/>У опоры</label>
                  <label class="chip"><input type="checkbox" value="Самостоятельно"/>Самостоятельно</label>
                </div>
              </div>

              <div class="group" data-field="kneeling">
                <div class="label-row"><div class="label">Переход в позу стоя на коленях</div></div>
                <div class="chips" data-type="checkbox-group">
                  <label class="chip"><input type="checkbox" value="Отсутствует"/>Отсутствует</label>
                  <label class="chip"><input type="checkbox" value="У опоры"/>У опоры</label>
                  <label class="chip"><input type="checkbox" value="Самостоятельно"/>Самостоятельно</label>
                  <label class="chip"><input type="checkbox" value="Передвигается у опоры"/>Передвигается у опоры</label>
                  <label class="chip"><input type="checkbox" value="Передвигается самостоятельно"/>Передвигается самостоятельно</label>
                </div>
              </div>

              <div class="group" data-field="to_sit">
                <div class="label-row"><div class="label">Переход в положение сидя</div></div>
                <div class="chips" data-type="checkbox-group">
                  <label class="chip"><input type="checkbox" value="С опорой на правую руку (D)"/>С опорой на правую руку (D)</label>
                  <label class="chip"><input type="checkbox" value="С опорой на левую руку (S)"/>С опорой на левую руку (S)</label>
                  <label class="chip"><input type="checkbox" value="При фиксации ног"/>При фиксации ног</label>
                  <label class="chip"><input type="checkbox" value="С поворотом на бок"/>С поворотом на бок</label>
                  <label class="chip"><input type="checkbox" value="Самостоятельно"/>Самостоятельно</label>
                </div>
              </div>
            </div>

            <div class="col-6">
              <div class="group" data-field="sitting">
                <div class="label-row"><div class="label">Сидит</div></div>
                <div class="chips" data-type="checkbox-group">
                  <label class="chip"><input type="checkbox" value="Не сидит"/>Не сидит</label>
                  <label class="chip"><input type="checkbox" value="По‑турецки"/>По‑турецки</label>
                  <label class="chip"><input type="checkbox" value="С прямыми ногами"/>С прямыми ногами</label>
                  <label class="chip"><input type="checkbox" value="С опущенными ногами"/>С опущенными ногами</label>
                  <label class="chip"><input type="checkbox" value="С опорой на руки"/>С опорой на руки</label>
                  <label class="chip"><input type="checkbox" value="D"/>D</label>
                  <label class="chip"><input type="checkbox" value="S"/>S</label>
                  <label class="chip"><input type="checkbox" value="Самостоятельно"/>Самостоятельно</label>
                  <label class="chip"><input type="checkbox" value="С помощью взрослого"/>С помощью взрослого</label>
                </div>
              </div>

              <div class="group" data-field="standing">
                <div class="label-row"><div class="label">Стоит</div></div>
                <div class="chips" data-type="checkbox-group">
                  <label class="chip"><input type="checkbox" value="Не стоит"/>Не стоит</label>
                  <label class="chip"><input type="checkbox" value="У опоры"/>У опоры</label>
                  <label class="chip"><input type="checkbox" value="С поддержкой за 1 руку"/>С поддержкой за 1 руку</label>
                  <label class="chip"><input type="checkbox" value="Несколько секунд"/>Несколько секунд</label>
                  <label class="chip"><input type="checkbox" value="Несколько минут"/>Несколько минут</label>
                  <label class="chip"><input type="checkbox" value="Долго"/>Долго</label>
                </div>
              </div>

              <div class="group" data-field="walking">
                <div class="label-row"><div class="label">Ходит</div></div>
                <div class="chips" data-type="checkbox-group">
                  <label class="chip"><input type="checkbox" value="Не ходит"/>Не ходит</label>
                  <label class="chip"><input type="checkbox" value="С поддержкой со стороны спины"/>С поддержкой со стороны спины</label>
                  <label class="chip"><input type="checkbox" value="С поддержкой за 1 руку (D)"/>С поддержкой за 1 руку (D)</label>
                  <label class="chip"><input type="checkbox" value="С поддержкой за 1 руку (S)"/>С поддержкой за 1 руку (S)</label>
                  <label class="chip"><input type="checkbox" value="Самостоятельно"/>Самостоятельно</label>
                  <label class="chip"><input type="checkbox" value="Устойчиво"/>Устойчиво</label>
                  <label class="chip"><input type="checkbox" value="Неустойчиво"/>Неустойчиво</label>
                  <label class="chip"><input type="checkbox" value="Стремительно"/>Стремительно</label>
                  <label class="chip"><input type="checkbox" value="С ортопедической обувью"/>С ортопедической обувью</label>
                  <label class="chip"><input type="checkbox" value="Без обуви"/>Без обуви</label>
                  <label class="chip"><input type="checkbox" value="Передвигается в ходунках"/>Передвигается в ходунках</label>
                  <label class="chip"><input type="checkbox" value="С колёсами спереди"/>С колёсами спереди</label>
                  <label class="chip"><input type="checkbox" value="С поддержкой типа "трусики""/>С поддержкой типа "трусики"</label>
                  <label class="chip"><input type="checkbox" value="С поддержкой сбоку и сзади"/>С поддержкой сбоку и сзади</label>
                  <label class="chip"><input type="checkbox" value="С четырёхопорной тростью"/>С четырёхопорной тростью</label>
                  <label class="chip"><input type="checkbox" value="С тростью"/>С тростью</label>
                  <label class="chip"><input type="checkbox" value="С канадскими палочками"/>С канадскими палочками</label>
                  <label class="chip"><input type="checkbox" value="Расстояние ≥ 5 м"/>Расстояние ≥ 5 м</label>
                  <label class="chip"><input type="checkbox" value="Расстояние ≥ 10 м"/>Расстояние ≥ 10 м</label>
                  <label class="chip"><input type="checkbox" value="Расстояние ≥ 25 м"/>Расстояние ≥ 25 м</label>
                  <label class="chip"><input type="checkbox" value="Расстояние ≥ 50 м"/>Расстояние ≥ 50 м</label>
                  <label class="chip"><input type="checkbox" value=", Более 50 м"/>, Более 50 м</label>
                </div>
              </div>

              <div class="row">
                <div class="field" style="flex:1" data-field="height_cm"><span class="muted">Рост (см)</span><input type="number" min="0" step="1"/></div>
                <div class="field" style="flex:1" data-field="weight_kg"><span class="muted">Вес (кг)</span><input type="number" min="0" step="0.1"/></div>
                <div class="field" style="flex:1" data-field="head_circ"><span class="muted">Окружность головы (см)</span><input type="number" min="0" step="0.1"/></div>
              </div>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="kicker">Комментарий</div>
          <div class="field" data-field="notes"><textarea rows="3" placeholder="Дополнительные наблюдения…"></textarea></div>
        </div>

        <div class="section">
          <div class="grid">
            <div class="col-6">
              <div class="field" data-field="therapist_name"><span class="muted">Методист ЛФК</span><input type="text" placeholder="ФИО"/></div>
            </div>
            <div class="col-3">
              <div class="field" data-field="exam_date"><span class="muted">Дата</span><input type="date"/></div>
            </div>
            <div class="col-3">
              <div class="field" data-field="signature_ref"><span class="muted">Подпись (примечание)</span><input type="text" placeholder="напр. хранится в Media"/></div>
            </div>
          </div>
        </div>
      </div>

      <div id="panel-gait" class="panel" hidden>
        <div class="section">
          <div class="kicker">Раздел</div>
          <h3>Походка — визуальная оценка</h3>
          <div class="grid">
            <div class="col-6">
              <div class="group" data-field="gait_spine">
                <div class="label-row"><div class="label">Спина</div><span class="hint">(по скриншоту: гиперлордоз/гиперкифоз/осевая асимметрия и пр.)</span></div>
                <div class="chips" data-type="checkbox-group">
                  <label class="chip"><input type="checkbox" value="Гиперлордоз (поясничный отдел)"/>Гиперлордоз (поясничный отдел)</label>
                  <label class="chip"><input type="checkbox" value="Гиперкифоз (грудной отдел)"/>Гиперкифоз (грудной отдел)</label>
                  <label class="chip"><input type="checkbox" value="Наклон вправо"/>Наклон вправо</label>
                  <label class="chip"><input type="checkbox" value="Наклон влево"/>Наклон влево</label>
                </div>
              </div>

              <div class="group" data-field="gait_lower_limbs">
                <div class="label-row"><div class="label">Установка нижних конечностей</div><span class="hint">(точные формулировки можно дополнить)</span></div>
                <div class="chips" data-type="checkbox-group">
                  <label class="chip"><input type="checkbox" value="Вальгус"/>Вальгус</label>
                  <label class="chip"><input type="checkbox" value="Варус"/>Варус</label>
                  <label class="chip"><input type="checkbox" value="Ассиметрия D"/>Ассиметрия D</label>
                  <label class="chip"><input type="checkbox" value="Ассиметрия S"/>Ассиметрия S</label>
                </div>
              </div>

              <div class="group" data-field="gait_contractures">
                <div class="label-row"><div class="label">Наличие контрактур (суставы)</div></div>
                <div class="field"><input type="text" placeholder="Например: коленный D 10°, голеностоп S 5°…"/></div>
              </div>

              <div class="group" data-field="gait_instability">
                <div class="label-row"><div class="label">Нестабильность в суставах</div></div>
                <div class="field"><input type="text" placeholder="Например: нестабильность плечевого, коленного…"/></div>
              </div>
            </div>

            <div class="col-6">
              <div class="group" data-field="gait_feet">
                <div class="label-row"><div class="label">Установка стоп</div><span class="hint">(вальгус/варус/пронация/супинация и др.)</span></div>
                <div class="chips" data-type="checkbox-group">
                  <label class="chip"><input type="checkbox" value="Пяточная вальгусная"/>Пяточная вальгусная</label>
                  <label class="chip"><input type="checkbox" value="Пяточная варусная"/>Пяточная варусная</label>
                  <label class="chip"><input type="checkbox" value="Пронация"/>Пронация</label>
                  <label class="chip"><input type="checkbox" value="Супинация"/>Супинация</label>
                  <label class="chip"><input type="checkbox" value="Приведение"/>Приведение</label>
                  <label class="chip"><input type="checkbox" value="Отведение"/>Отведение</label>
                </div>
              </div>

              <div class="group" data-field="gait_comment">
                <div class="label-row"><div class="label">Прочее (походка)</div></div>
                <div class="field"><textarea rows="6" placeholder="Запишите особенности походки (темп, симметрия шага, опора и т.д.)"></textarea></div>
              </div>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="kicker">Вложения</div>
          <div class="field" data-field="media_refs"><input type="text" placeholder="Ссылка(и) на видео походки/фото в Media (ID, URL)…"/></div>
        </div>
      </div>

      <div id="panel-plan" class="panel" hidden>
        <div class="section">
          <div class="kicker">Шаблон из второго скриншота</div>
          <h3>План терапии / задачи курса</h3>
          <div class="hint" style="margin-bottom:8px">Ниже — минимальный план с возможностью добавлять пункты. Точные поля из скриншота 2 можно внести через редактирование заголовков/колонок.</div>
          <div class="hr"></div>
          <div class="row" style="margin-bottom:8px">
            <div class="field" style="flex: 1" data-field="course_goal"><span class="muted">Цель курса</span><input type="text" placeholder="Например: улучшение устойчивости, ↓ спастики…"/></div>
            <div class="field" style="width: 220px" data-field="course_duration_weeks"><span class="muted">Длительность (нед.)</span><input type="number" min="0" step="1"/></div>
            <div class="field" style="width: 220px" data-field="sessions_per_week"><span class="muted">Сессий в неделю</span><input type="number" min="0" step="1"/></div>
          </div>

          <div id="tasks"></div>
          <div class="row" style="margin-top:10px">
            <button type="button" id="addTaskBtn">+ Добавить пункт</button>
          </div>
        </div>

        <div class="section">
          <div class="grid">
            <div class="col-6">
              <div class="field" data-field="plan_author"><span class="muted">Составил(а)</span><input type="text" placeholder="ФИО" /></div>
            </div>
            <div class="col-3">
              <div class="field" data-field="plan_date"><span class="muted">Дата</span><input type="date" /></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ====== ТЕСТ 2: FIM ====== -->
    <div id="test-fim" data-test="fim" hidden>
      <div class="panel">
        <div class="section">
          <div class="kicker">Метаданные</div>
          <div class="row">
            <div class="field" data-field="fim_patient_ref"><span class="muted">Пациент</span><input type="text" placeholder="ID/ФИО (позже подтянется из базы)"/></div>
            <div class="field" style="width:220px" data-field="fim_date"><span class="muted">Дата</span><input type="date"/></div>
          </div>
        </div>

        <div class="section">
          <div class="kicker">Оценка FIM</div>
          
          <!-- Блок визуализации -->
          <div class="chart-section">
            <h3>Визуализация</h3>
            <div class="chart-container">
              <canvas id="fimChart" height="350"></canvas>
            </div>
            <div class="chart-legend" style="text-align:center; margin-top:10px;">
              <div style="margin-bottom:8px;">
                <span class="pill"><span style="display:inline-block; width:14px; height:14px; background-color:rgba(75, 192, 192, 0.6); margin-right:5px;"></span>Поступление</span>
                <span class="pill"><span style="display:inline-block; width:14px; height:14px; background-color:rgba(153, 102, 255, 0.6); margin-right:5px;"></span>Выписка</span>
              </div>
              <div class="hint">Радарная диаграмма показывает оценки по всем пунктам FIM</div>
            </div>
          </div>
          
          <!-- Таблица FIM -->
          <div class="fim-table-section">
            <div class="fim-table-container">
              <div class="fim-table-header">
                <div class="fim-col-label">Пункт (1–18)</div>
                <div class="fim-col-input">Поступление</div>
                <div class="fim-col-input">Выписка</div>
              </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">1. Приём пищи</div>
                  <div class="fim-col-input field" data-field="fim_eating_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_eating_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">2. Личная гигиена</div>
                  <div class="fim-col-input field" data-field="fim_grooming_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_grooming_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">3. Принятие ванны/душа</div>
                  <div class="fim-col-input field" data-field="fim_bathing_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_bathing_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">4. Одевание верхней части</div>
                  <div class="fim-col-input field" data-field="fim_dress_upper_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_dress_upper_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">5. Одевание нижней части</div>
                  <div class="fim-col-input field" data-field="fim_dress_lower_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_dress_lower_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">6. Туалет</div>
                  <div class="fim-col-input field" data-field="fim_toileting_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_toileting_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">7. Мочевой пузырь</div>
                  <div class="fim-col-input field" data-field="fim_bladder_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_bladder_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">8. Кишечник</div>
                  <div class="fim-col-input field" data-field="fim_bowel_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_bowel_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">9. Пересаживание: кровать/стул/кресло</div>
                  <div class="fim-col-input field" data-field="fim_bed_transfer_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_bed_transfer_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">10. Пересаживание: туалет</div>
                  <div class="fim-col-input field" data-field="fim_toilet_transfer_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_toilet_transfer_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">11. Пересаживание: ванна/душ</div>
                  <div class="fim-col-input field" data-field="fim_bath_transfer_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_bath_transfer_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">12. Передвижение / коляска</div>
                  <div class="fim-col-input field" data-field="fim_locomotion_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_locomotion_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">13. Подъём по лестнице</div>
                  <div class="fim-col-input field" data-field="fim_stairs_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_stairs_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">14. Понимание (восприятие)</div>
                  <div class="fim-col-input field" data-field="fim_comprehension_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_comprehension_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">15. Выражение (экспрессия)</div>
                  <div class="fim-col-input field" data-field="fim_expression_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_expression_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">16. Социальное взаимодействие</div>
                  <div class="fim-col-input field" data-field="fim_social_interaction_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_social_interaction_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">17. Решение проблем</div>
                  <div class="fim-col-input field" data-field="fim_problem_solving_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_problem_solving_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
                <div class="fim-table-row">
                  <div class="fim-col-label">18. Память</div>
                  <div class="fim-col-input field" data-field="fim_memory_adm">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                  <div class="fim-col-input field" data-field="fim_memory_dis">
                    <select><option value="">—</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select>
                  </div>
                </div>
              </div>
              <div class="hr"></div>
              <div class="grid">
                <div class="col-4">
                  <div class="field" data-field="fim_motor_adm"><span class="muted">Двигательные (1–13), поступление</span><input type="number" readonly/></div>
                </div>
                <div class="col-4">
                  <div class="field" data-field="fim_motor_dis"><span class="muted">Двигательные (1–13), выписка</span><input type="number" readonly/></div>
                </div>
                <div class="col-4"></div>
                <div class="col-4">
                  <div class="field" data-field="fim_cog_adm"><span class="muted">Когнитивные (14–18), поступление</span><input type="number" readonly/></div>
                </div>
                <div class="col-4">
                  <div class="field" data-field="fim_cog_dis"><span class="muted">Когнитивные (14–18), выписка</span><input type="number" readonly/></div>
                </div>
                <div class="col-4"></div>
                <div class="col-4">
                  <div class="field" data-field="fim_total_adm"><span class="muted">Итого (18), поступление</span><input type="number" readonly/></div>
                </div>
                <div class="col-4">
                  <div class="field" data-field="fim_total_dis"><span class="muted">Итого (18), выписка</span><input type="number" readonly/></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="kicker">Комментарий</div>
          <div class="field" data-field="fim_notes"><textarea rows="3" placeholder="Замечания по FIM…"></textarea></div>
        </div>
        
        <div class="section">
          <div class="kicker">Шкала оценки FIM</div>
          <div class="grid">
            <div class="col-4">
              <div class="scale-item">
                <strong>7</strong> — Полная независимость (безопасно, своевременно)
              </div>
              <div class="scale-item">
                <strong>6</strong> — Ограниченная независимость (вспомогательные устройства)
              </div>
              <div class="scale-item">
                <strong>5</strong> — Наблюдение/подготовка (наблюдение, подсказки)
              </div>
            </div>
            <div class="col-4">
              <div class="scale-item">
                <strong>4</strong> — Минимальная помощь (пациент ≥ 75% усилий)
              </div>
              <div class="scale-item">
                <strong>3</strong> — Умеренная помощь (пациент 50-74% усилий)
              </div>
              <div class="scale-item">
                <strong>2</strong> — Существенная помощь (пациент 25-49% усилий)
              </div>
            </div>
            <div class="col-4">
              <div class="scale-item">
                <strong>1</strong> — Полная зависимость (пациент < 25% усилий)
              </div>
              <div class="hr"></div>
              <div class="scale-item">
                <strong>Максимум:</strong> 126 баллов (18 пунктов × 7)
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ====== ТЕСТ 3: Управление пациентами ====== -->
    <div id="test-patients" data-test="patients" hidden>
      <div class="panel">
        <div class="section">
          <div class="kicker">Управление пациентами</div>
          <h3>Создание и редактирование пациентов</h3>
          
          <!-- Форма создания/редактирования пациента -->
          <div class="patient-form">
            <div class="grid">
              <div class="col-6">
                <div class="field" data-field="patient_name">
                  <span class="muted">ФИО пациента *</span>
                  <input type="text" placeholder="Иванов Иван Иванович" required />
                </div>
              </div>
              <div class="col-6">
                <div class="field" data-field="patient_contact">
                  <span class="muted">Контактная информация</span>
                  <input type="text" placeholder="Телефон, email или адрес" />
                </div>
              </div>
              <div class="col-8">
                <div class="field" data-field="patient_diagnosis">
                  <span class="muted">Диагноз *</span>
                  <input type="text" placeholder="ДЦП, спастическая диплегия" required />
                </div>
              </div>
              <div class="col-4">
                <div class="field" data-field="patient_status">
                  <span class="muted">Статус</span>
                  <select>
                    <option value="active">Активный</option>
                    <option value="completed">Завершен</option>
                    <option value="paused">Приостановлен</option>
                    <option value="archived">Архив</option>
                  </select>
                </div>
              </div>
              <div class="col-12">
                <div class="field" data-field="patient_forms_links">
                  <span class="muted">Ссылки на заполненные формы</span>
                  <textarea rows="3" placeholder="Ссылки на JSON файлы или другие документы..."></textarea>
                </div>
              </div>
            </div>
            
            <div class="form-actions">
              <button type="button" class="primary" id="savePatientBtn">Сохранить пациента</button>
              <button type="button" id="clearPatientFormBtn">Очистить форму</button>
              <button type="button" id="deletePatientBtn" style="display:none;">Удалить пациента</button>
            </div>
          </div>
          
          <div class="hr"></div>
          
          <!-- Список пациентов -->
          <div class="patients-list">
            <h4>Список пациентов</h4>
            <div class="patients-table">
              <div class="patients-table-header">
                <div class="col-name">ФИО</div>
                <div class="col-diagnosis">Диагноз</div>
                <div class="col-status">Статус</div>
                <div class="col-actions">Действия</div>
              </div>
              <div id="patientsTableBody">
                <!-- Пациенты будут загружены динамически -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <span class="muted">Каждый тест хранится отдельно (LocalStorage). Экспортируйте JSON для передачи в ИС / привязки к пациенту.</span>
  </footer>

  <script src="js/patients.js"></script>
  <script src="js/app.js"></script>
</body>
</html>